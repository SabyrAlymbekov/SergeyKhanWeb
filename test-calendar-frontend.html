<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è garant-master</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .credentials {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è garant-master</h1>
        
        <div class="credentials">
            <h3>üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</h3>
            <strong>Email:</strong> garant_master@example.com<br>
            <strong>–ü–∞—Ä–æ–ª—å:</strong> garant123<br>
            <strong>–†–æ–ª—å:</strong> warrant-master
        </div>

        <div class="test-section">
            <h3>üîë 1. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
            <button onclick="testAuth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
            <div id="auth-result"></div>
        </div>

        <div class="test-section">
            <h3>üìÖ 2. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π</h3>
            <button onclick="testGetEvents()">–ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è</button>
            <div id="events-result"></div>
        </div>

        <div class="test-section">
            <h3>‚ûï 3. –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è</h3>
            <button onclick="testCreateEvent()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</button>
            <div id="create-result"></div>
        </div>

        <div class="test-section">
            <h3>üîó 4. –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
            <button onclick="openCalendar()">–û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
            <button onclick="openLogin()">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞</button>
            <button onclick="testAllEndpoints()">–¢–µ—Å—Ç –≤—Å–µ—Ö endpoints</button>
        </div>

        <div class="test-section">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
            <div id="test-summary"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8000';
        const FRONTEND_URL = 'http://localhost:3000';
        
        let authToken = null;
        let testResults = [];

        function addResult(test, success, message, details = null) {
            const resultDiv = document.getElementById(test + '-result');
            const className = success ? 'success' : 'error';
            let html = `<div class="test-result ${className}">
                ${success ? '‚úÖ' : '‚ùå'} ${message}
            </div>`;
            
            if (details) {
                html += `<pre>${JSON.stringify(details, null, 2)}</pre>`;
            }
            
            resultDiv.innerHTML = html;
            
            testResults.push({
                test,
                success,
                message,
                details
            });
            
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('test-summary');
            const passed = testResults.filter(r => r.success).length;
            const total = testResults.length;
            
            summaryDiv.innerHTML = `
                <div class="test-result info">
                    üìà –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${passed}/${total}
                    ${passed === total ? ' üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!' : ''}
                </div>
            `;
        }

        async function testAuth() {
            try {
                const response = await fetch(`${BASE_URL}/login/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'garant_master@example.com',
                        password: 'garant123'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    addResult('auth', true, '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞', {
                        token: data.token.substring(0, 20) + '...',
                        user: data.user
                    });
                } else {
                    const errorData = await response.json();
                    addResult('auth', false, `–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${response.status}`, errorData);
                }
            } catch (error) {
                addResult('auth', false, `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        }

        async function testGetEvents() {
            if (!authToken) {
                addResult('events', false, '–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/mine`, {
                    headers: {
                        'Authorization': `Token ${authToken}`
                    }
                });

                if (response.ok) {
                    const events = await response.json();
                    addResult('events', true, `–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: ${events.length}`, events);
                } else {
                    const errorData = await response.json();
                    addResult('events', false, `–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π: ${response.status}`, errorData);
                }
            } catch (error) {
                addResult('events', false, `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        }

        async function testCreateEvent() {
            if (!authToken) {
                addResult('create', false, '–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è');
                return;
            }

            const testEvent = {
                title: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞',
                start: new Date().toISOString(),
                end: new Date(Date.now() + 3600000).toISOString(), // +1 —á–∞—Å
                allDay: false
            };

            try {
                const response = await fetch(`${BASE_URL}/create/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Token ${authToken}`
                    },
                    body: JSON.stringify(testEvent)
                });

                if (response.ok) {
                    const createdEvent = await response.json();
                    addResult('create', true, '–°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ', createdEvent);
                } else {
                    const errorData = await response.json();
                    addResult('create', false, `–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è: ${response.status}`, errorData);
                }
            } catch (error) {
                addResult('create', false, `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        }

        async function testAllEndpoints() {
            addResult('test-summary', true, '–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');
            
            await testAuth();
            await new Promise(resolve => setTimeout(resolve, 500)); // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            
            await testGetEvents();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testCreateEvent();
        }

        function openCalendar() {
            window.open(`${FRONTEND_URL}/calendar`, '_blank');
        }

        function openLogin() {
            window.open(`${FRONTEND_URL}/login`, '_blank');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            addResult('test-summary', true, '–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤.');
        });
    </script>
</body>
</html>
